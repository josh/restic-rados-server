create-pool meta
create-pool data

exec restic-rados-server --pool=$CEPH_POOL_DATA:data,snapshots --pool=$CEPH_POOL_META:config,index --listen $WORK/restic.sock &server&
wait4socket $WORK/restic.sock

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true' --output /dev/null
stdout '200'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock 'http://localhost/keys/' --output $WORK/keys-response.txt
stdout '503'

exec cat $WORK/keys-response.txt
stdout 'repository not initialized'

kill server
